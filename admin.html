<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Swarup QnA Admin Panel</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2e7d32;
    }
    form {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      max-width: 600px;
      margin: auto;
    }
    form input, form textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    form button {
      padding: 10px 20px;
      background-color: #2e7d32;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      padding: 10px;
      background: white;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #e0f2f1;
    }
    button.edit, button.delete {
      padding: 5px 10px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    button.edit {
      background-color: #0288d1;
      color: white;
    }
    button.delete {
      background-color: #c62828;
      color: white;
    }
  </style>
</head>
<body>

  <h1>Swarup QnA Admin Panel</h1>

  <form id="qna-form">
    <input type="text" id="class" placeholder="Class" required>
    <input type="text" id="subject" placeholder="Subject" required>
    <input type="text" id="chapter" placeholder="Chapter" required>
    <input type="text" id="marks" placeholder="Marks" required>
    <textarea id="question" placeholder="Enter Question" required></textarea>
    <textarea id="answer" placeholder="Enter Answer" required></textarea>
    <button type="submit">Save QnA</button>
    <input type="hidden" id="edit-id">
  </form>

  <table id="qna-table">
    <thead>
      <tr>
        <th>Class</th>
        <th>Subject</th>
        <th>Chapter</th>
        <th>Marks</th>
        <th>Question</th>
        <th>Answer</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, addDoc, deleteDoc, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyApDnDrhy_Z0zvLoWfvsmP4JJSUIdtSulM",
      authDomain: "qnasite-6d9cc.firebaseapp.com",
      projectId: "qnasite-6d9cc",
      storageBucket: "qnasite-6d9cc.firebasestorage.app",
      messagingSenderId: "707268852195",
      appId: "1:707268852195:web:05e13ee17b0d96253688d6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const qnaRef = collection(db, "qna");

    const form = document.getElementById("qna-form");
    const tableBody = document.querySelector("#qna-table tbody");

    const inputFields = {
      class: document.getElementById("class"),
      subject: document.getElementById("subject"),
      chapter: document.getElementById("chapter"),
      marks: document.getElementById("marks"),
      question: document.getElementById("question"),
      answer: document.getElementById("answer"),
      editId: document.getElementById("edit-id")
    };

    async function fetchQnAs() {
      tableBody.innerHTML = "";
      const snapshot = await getDocs(qnaRef);
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.class}</td>
          <td>${data.subject}</td>
          <td>${data.chapter}</td>
          <td>${data.marks}</td>
          <td>${data.question}</td>
          <td>${data.answer}</td>
          <td>
            <button class="edit" data-id="${docSnap.id}">Edit</button>
            <button class="delete" data-id="${docSnap.id}">Delete</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const qnaData = {
        class: inputFields.class.value,
        subject: inputFields.subject.value,
        chapter: inputFields.chapter.value,
        marks: inputFields.marks.value,
        question: inputFields.question.value,
        answer: inputFields.answer.value
      };

      const id = inputFields.editId.value;
      if (id) {
        const docRef = doc(db, "qna", id);
        await updateDoc(docRef, qnaData);
        inputFields.editId.value = "";
      } else {
        await addDoc(qnaRef, qnaData);
      }

      form.reset();
      fetchQnAs();
    });

    tableBody.addEventListener("click", async (e) => {
      if (e.target.classList.contains("delete")) {
        const id = e.target.dataset.id;
        await deleteDoc(doc(db, "qna", id));
        fetchQnAs();
      }

      if (e.target.classList.contains("edit")) {
        const id = e.target.dataset.id;
        const docSnap = await getDocs(qnaRef);
        docSnap.forEach(docu => {
          if (docu.id === id) {
            const data = docu.data();
            inputFields.class.value = data.class;
            inputFields.subject.value = data.subject;
            inputFields.chapter.value = data.chapter;
            inputFields.marks.value = data.marks;
            inputFields.question.value = data.question;
            inputFields.answer.value = data.answer;
            inputFields.editId.value = id;
          }
        });
      }
    });

    fetchQnAs();
  </script>

</body>
</html>
