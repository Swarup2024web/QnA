<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Swarup QnA Admin Panel</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    input, select, button {
      padding: 10px;
      margin: 5px;
      width: 100%;
      max-width: 300px;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h2>Swarup QnA Admin Panel</h2>

  <div class="row">
    <input type="text" id="classInput" placeholder="Class" />
    <input type="text" id="subjectInput" placeholder="Subject" />
    <input type="text" id="chapterInput" placeholder="Chapter" />
    <input type="number" id="marksInput" placeholder="Marks" />
    <textarea id="questionInput" placeholder="Question"></textarea>
    <textarea id="answerInput" placeholder="Answer"></textarea>
    <button id="addBtn">Add QnA</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Class</th>
        <th>Subject</th>
        <th>Chapter</th>
        <th>Marks</th>
        <th>Question</th>
        <th>Answer</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="qnaTableBody"></tbody>
  </table>

  <script type="module">
    import {
      db, collection, getDocs, addDoc, deleteDoc, doc
    } from './firebase.js';

    const qnaCollection = collection(db, "qna");

    const classInput = document.getElementById("classInput");
    const subjectInput = document.getElementById("subjectInput");
    const chapterInput = document.getElementById("chapterInput");
    const marksInput = document.getElementById("marksInput");
    const questionInput = document.getElementById("questionInput");
    const answerInput = document.getElementById("answerInput");
    const addBtn = document.getElementById("addBtn");
    const qnaTableBody = document.getElementById("qnaTableBody");

    async function fetchQnA() {
      const snapshot = await getDocs(qnaCollection);
      qnaTableBody.innerHTML = '';
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${data.class}</td>
          <td>${data.subject}</td>
          <td>${data.chapter}</td>
          <td>${data.marks}</td>
          <td>${data.question}</td>
          <td>${data.answer}</td>
          <td><button onclick="deleteQnA('${docSnap.id}')">Delete</button></td>
        `;
        qnaTableBody.appendChild(tr);
      });
    }

    async function addQnA() {
      const newQnA = {
        class: classInput.value,
        subject: subjectInput.value,
        chapter: chapterInput.value,
        marks: Number(marksInput.value),
        question: questionInput.value,
        answer: answerInput.value
      };
      if (!newQnA.class || !newQnA.subject || !newQnA.question || !newQnA.answer) {
        alert("Please fill all required fields");
        return;
      }
      try {
        await addDoc(qnaCollection, newQnA);
        alert("QnA added!");
        fetchQnA();
        classInput.value = subjectInput.value = chapterInput.value = marksInput.value = questionInput.value = answerInput.value = '';
      } catch (e) {
        console.error("Error adding QnA:", e);
        alert("Failed to add QnA");
      }
    }

    window.deleteQnA = async function (id) {
      try {
        await deleteDoc(doc(qnaCollection, id));
        fetchQnA();
      } catch (e) {
        console.error("Error deleting QnA:", e);
      }
    };

    addBtn.addEventListener("click", addQnA);
    fetchQnA();
  </script>
</body>
</html>
